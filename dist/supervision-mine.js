!function(e){function t(a){if(r[a])return r[a].exports;var s=r[a]={exports:{},id:a,loaded:!1};return e[a].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var s=r(1),n=a(s),i=r(2),o=window.interfaceSettings.supervisionRequest.api;window.userLoginInfo={userid:(0,i.getCookie)("userid"),username:(0,i.getCookie)("username")};for(var c=new Vue({el:"#filterSection",data:{userLoginInfo:{},filterOptions:{areaCode:[],sourceCode:[]},dateFilter:[{title:"全部",status:!0},{title:"上周",status:!0},{title:"本周",status:!0},{title:"下周",status:!0},{title:"时段",status:!0}],dateOptions:{show:!1,type:"date",value:"2016-6-21",begin:"2016-6-20",end:"2016-12-25",x:0,y:0,range:!0},area:[],source:[],derivedMeeting:[],stateList:[{label:"正常",value:!0,feature:"label-success",margin:"50%"},{label:"一周内过期",value:!0,feature:"label-warning",margin:""},{label:"已过期",value:!0,feature:"label-danger",margin:""},{label:"已完成",value:!1,feature:"label-default",margin:""}]},methods:{changeTime:function(e){e.stopPropagation();var t=e.currentTarget,r=$(t),a=t.getAttribute("data-mark");if(!r.hasClass("btn-success")||"custom"==a){switch($("#datePicker").find(".btn").removeClass("btn-success"),r.addClass("btn-success"),a){case"all":delete this.filterOptions.searchBeginDate,delete this.filterOptions.searchEndDate;break;case"lastweek":this.filterOptions.searchBeginDate=moment().day(-6).format("YYYY-MM-DD"),this.filterOptions.searchEndDate=moment().day(0).format("YYYY-MM-DD");break;case"thisweek":this.filterOptions.searchBeginDate=moment().weekday(1).format("YYYY-MM-DD"),this.filterOptions.searchEndDate=moment().day(7).format("YYYY-MM-DD");break;case"nextweek":this.filterOptions.searchBeginDate=moment().day(8).format("YYYY-MM-DD"),this.filterOptions.searchEndDate=moment().day(14).format("YYYY-MM-DD");break;case"custom":this.filterOptions.searchBeginDate=$("#startDate").val(),this.filterOptions.searchEndDate=$("#endDate").val()}d.fetchTransactions(o.searchUrl)}},changeArea:function(e,t){if("source"==t&&(0==e||"MEETING"==this.source[e].diccode))for(var r=this.filterOptions.sourceCode,a=this.derivedMeeting,s=0;s<a.length;s++){var n=$.inArray(a[s].diccode,r);n>-1&&(r.splice(n,1),this.derivedMeeting[s].status="0")}var i=this[t];if(0==e){if("1"==i[0].status)return;i[0].status="1";for(var c=1,u=i.length;c<u;c++)i[c].status="0";this.filterOptions[t+"Code"]=[]}else{var l=this.filterOptions[t+"Code"];if(i[0].status="0","1"==i[e].status){i[e].status="0";for(var f in l)l[f]==i[e].diccode&&l.splice(f,1)}else i[e].status="1",l.push(i[e].diccode);this.filterOptions[t+"Code"]=l}this[t]=i,d.fetchTransactions(o.searchUrl)},changeMeeting:function(e){var t=this.source,r=this.filterOptions.sourceCode;if("1"==t[0].status){t[0].status="0";var a=$.inArray(t[0].diccode,r);r.splice(a,1)}for(var s=1;s<t.length;s++)if("MEETING"==t[s].diccode&&"1"==t[s].status){t[s].status="0";var n=$.inArray(t[s].diccode,r);r.splice(n,1);break}var i=this.derivedMeeting[e],c=$.inArray(i.diccode,r);c>-1?(r.splice(c,1),i.status="0"):(i.status="1",r.push(i.diccode)),d.fetchTransactions(o.searchUrl)}},created:function(){var e=this,t={supAreaUrl:o.supAreaUrl,supSourceUrl:o.supSourceUrl,completedRateStatistics:o.completedRateStatistics};for(var r in t)"completedRateStatistics"==r?t[r]=(0,i.setSupervisionHeader)(t[r],null,window.userLoginInfo.userid):t[r]=(0,i.setSupervisionHeader)(t[r]),$.ajax({type:"get",dataType:"json",url:t[r],success:function(t,r,a){var s=a.key;if("completedRateStatistics"==s){var n=t[1]+"/"+(t[0]+t[1]);return void $("#completedRateStatistics").text(n)}for(var i in t)t[i].status="0";var o=[{status:"1",dicname:"全部"}];if("supAreaUrl"==s)e.area=o.concat(t);else{for(var c=[],u=[],l=0;l<t.length;l++)"10019"==t[l].parentid?c.push(t[l]):u.push(t[l]);e.derivedMeeting=c,e.source=o.concat(u)}},error:function(e,t,r){}}).key=r},ready:function(){$("#startDate").daterangepicker({language:"zh-CN",singleDatePicker:!0,showDropdowns:!0}),$("#endDate").daterangepicker({singleDatePicker:!0,showDropdowns:!0})}}),u=new Array(8),l=0;l<8;l++)u[l]="sorting";var d=new Vue({el:"#result-section",data:{ths:[{key:"code",val:"督办编号"},{key:"name",val:"督办事项名称"},{key:"accountablename",val:"发起人(A)"},{key:"responsiblename",val:"责任人(R)"},{key:"estimatedcompletetiontime",val:"计划完成时间"},{key:"urgency",val:"紧急程度"},{key:"importance",val:"重要程度"},{key:"rate",val:"最新进展"}],keyItems:{sorting:u,total:[],show:[],current:1},otherItems:{sorting:u,total:[],show:[],current:1},doneItems:{sorting:u,total:[],show:[],current:1},orgItems:{sorting:u,total:[],show:[],current:1},levelBackground:["gray","#A1C636","#5CB85C","#F0AD4E","#D9534F"],sizeOptions:[{text:"3",value:"3"},{text:"10",value:"10"},{text:"20",value:"20"}]},created:function(){var e=(0,i.getCookie)("userid"),t=(0,i.getCookie)("username"),r=((0,i.getCookie)("userorg"),(0,i.getCookie)("userorg"));r&&(r=JSON.parse((0,i.getCookie)("userorg"))),e&&""!=e?(this.userLoginInfo={userid:e,username:t,orgtree:r},this.fetchTransactions(o.searchUrl)):location.href="http://bjecm.cnnp.com.cn/pt/LoginServlet?url="+Base64.encode(window.location.href)},ready:function(){var e=this;$(".pagesize").change(function(t){var r=t.currentTarget,a=r.getAttribute("data-key"),s=Number(e[a+"Items"].total.length);$("#"+a+"-pagination").extendPagination({totalCount:s,limit:r.value,name:a,callback:function(t,r,a,s){e.changePage(t,r,a,s)}}),e.changePage(1,r.value,s,a)})},methods:{changePage:function(e,t,r,a){var s=this[a+"Items"];s.current=e,this.changeHandler(e,a,s)},sortColumn:function(e,t){function r(e,t){return/^\d/.test(e)^/^\D/.test(t)?e>t?1:e==t?0:-1:e>t?-1:e==t?0:1}var a=this,s=this[t+"Items"],n=s.sorting[e];"sorting_asc"==n?!function(){var n=u.concat();n[e]="sorting_desc",s.sorting=n;var i=a.ths[e].key;s.total.sort(function(e,t){return r(t[i],e[i])}),a.changeHandler(s.current,t,s)}():!function(){var n=u.concat();n[e]="sorting_asc",s.sorting=n;var i=a.ths[e].key;s.total.sort(function(e,t){return r(e[i],t[i])}),a.changeHandler(s.current,t,s)}()},changeHandler:function(e,t,r){var a=$("#"+t+"PagesizeSelect").find("select").val();r.show=r.total.slice((e-1)*a,a*e)},fetchTransactions:function(e){e=(0,i.setSupervisionHeader)(e,{page:0,size:1e3});var t={};for(var r in c.filterOptions)t[r]=c.filterOptions[r];0==t.areaCode.length?delete t.areaCode:t.areaCode=t.areaCode.join(","),t.source=t.sourceCode,delete t.sourceCode,0==t.source.length?delete t.source:t.source=t.source.join(",");var a=this;t.accountableSN=this.userLoginInfo.userid,t.responsibleSN=this.userLoginInfo.userid;var s=this.userLoginInfo.orgtree;if(s&&s[2])for(var o in s[2])t.responsibleDeptCode=o;t=(0,n.default)(t),$.ajax({type:"POST",dataType:"json",data:t,contentType:"application/json",url:e,success:function(e,t,r){for(var s=[],n=[],i=[],o=[],c=0,l=e.length;c<l;c++){var d=e[c];if(d.latestTrace?(d.rate=d.latestTrace.rate,d.latestDesc=d.latestTrace.description):(d.rate=0,d.latestDesc=""),d.rate<25?d.rateState="progress-bar-danger":d.rate<75?d.rateState="progress-bar-warning":d.rateState="progress-bar-success",d.responsiblesn==a.userLoginInfo.userid)if(1==d.status)s.push(d);else{var f=new moment,p=new moment(d.estimatedcompletetiontime),g=p.diff(f,"days");g>6&&d.urgency<4&&d.importance<4?i.push(d):n.push(d)}else o.push(d)}var h={doneList:s,keyList:n,otherList:i,orgList:o},v=u.concat(),m=$("#"+name+"PagesizeSelect").find("select").val()||3,y=["key","other","done","org"];for(var k in y){var b=y[k];a[b+"Items"]={total:h[b+"List"],show:h[b+"List"].slice(0,m),sorting:v,current:1};var D=Number(m)||3,S=Number(a[b+"Items"].total.length);S<4?$("#"+b+"PagesizeSelect").hide():$("#"+b+"PagesizeSelect").show(),$("#"+b+"-pagination").extendPagination({totalCount:S,limit:D,name:b,callback:function(e,t,r,s){a.changePage(e,t,r,s)}})}},error:function(e,t,r){}})},newfunc:function(){}}})},function(e,t,r){e.exports={default:r(3),__esModule:!0}},function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,r,a,s,n){if(r){var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3);var o=i.toGMTString()}else var o="";var c=e+"="+escape(t);o&&(c+=";expires="+o),a&&(c+=";path="+escape(a)),s&&(c+=";domain="+escape(s)),n&&(c+=";secure="+n),document.cookie=c}function n(e){var t,r=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(r))?unescape(t[2]):null}function i(e){var t=new Date;t.setTime(t.getTime()-864e5),s(e,"",t,"/")}function o(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),r=window.location.search.substr(1).match(t);return null!=r?unescape(r[2]):null}function c(){$.blockUI({message:"数据获取中，请稍候... ...",css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}})}function u(e,t){var r=function(e,r,a){for(var s=0,n=e.length;s<n;s++)e[s].publishDate&&(e[s].publishDate=e[s].publishDate.substring(5));t.list=e,t.successNext&&t.successNext()},a=function(e,t,r){},s={type:"get",url:e.URL+e.QueryString,success:r,error:a};"post"==e.METHOD&&(s={type:"post",url:e.URL+e.QueryString,data:e.PLAYLOAD,contentType:e.CONTENT_TYPE,success:r,error:a}),$.ajax(s)}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAjaxService=t.loadingCover=t.getQueryString=t.deleteCookie=t.getCookie=t.setCookie=t.add_supervision=t.fetch_sourceFromServer=t.fetch_areaFromServer=t.fetch_deptsFromServer=t.fetch_serviceByHttpProtocol=t.setSupervisionHeader=void 0;var l=r(1),d=a(l),f=window.interfaceSettings.supervisionRequest,p=function(e,t,r){return t||(t={stamp:(new Date).getTime()}),(r?e.replace("%id%",r):e)+"?"+(t?$.param($.extend({},f.header,t)):$.param(f.header))},g=function(e,t,r,a,s){"post"==t&&(r=(0,d.default)(r)),$.ajax({url:e,type:t,data:r,contentType:"application/json",success:function(e,t,r){a(e,t,r)},error:function(e,t,r){s(e,t,r)}})},h=function(e,t){var r=p(f.api.deptUrl,null,e);g(r,"get",{},t,function(e,t,r){})},v=function(e){var t=p(f.api.supSourceUrl);g(t,"get",{},e,function(e,t,r){})},m=function(e){var t=p(f.api.supAreaUrl);g(t,"get",{},e,function(e,t,r){})},y=function(e,t){var r=p(f.api.supAddUrl);g(r,"post",e,t,function(e,t,r){})};t.setSupervisionHeader=p,t.fetch_serviceByHttpProtocol=g,t.fetch_deptsFromServer=h,t.fetch_areaFromServer=m,t.fetch_sourceFromServer=v,t.add_supervision=y,t.setCookie=s,t.getCookie=n,t.deleteCookie=i,t.getQueryString=o,t.loadingCover=c,t.fetchAjaxService=u},function(e,t,r){var a=r(4),s=a.JSON||(a.JSON={stringify:JSON.stringify});e.exports=function(e){return s.stringify.apply(s,arguments)}},function(e,t){var r=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)}]);